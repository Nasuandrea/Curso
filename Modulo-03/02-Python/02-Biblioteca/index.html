<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de Biblioteca</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form, div { margin-bottom: 20px; }
        input, select, button { margin: 5px; padding: 8px; }
        #resultados-busqueda, #lista-disponibles { border: 1px solid #ccc; padding: 10px; min-height: 50px; }
        #campos-libro, #campos-revista { margin-left: 20px; }
    </style>
</head>
<body>
    <h1>Sistema de Biblioteca</h1>

    <!-- Formulario para agregar material -->
    <h2>Agregar Material</h2>
    <form id="form-agregar">
        <label>Tipo:</label>
        <select id="tipo">
            <option value="libro">Libro</option>
            <option value="revista">Revista</option>
        </select><br>
        <input type="text" id="titulo" placeholder="Título" required><br>
        <input type="number" id="anho" placeholder="Año" required><br>
        <!-- Campos específicos para libro -->
        <div id="campos-libro">
            <input type="text" id="autor" placeholder="Autor"><br>
            <input type="text" id="isbn" placeholder="ISBN"><br>
            <input type="number" id="num_paginas" placeholder="Número de páginas"><br>
        </div>
        <!-- Campos específicos para revista -->
        <div id="campos-revista" style="display:none;">
            <input type="text" id="editorial" placeholder="Editorial"><br>
            <input type="number" id="numero" placeholder="Número"><br>
            <input type="text" id="mes" placeholder="Mes"><br>
        </div>
        <button type="submit">Agregar</button>
    </form>

    <!-- Buscar por título -->
    <h2>Buscar por Título</h2>
    <input type="text" id="buscar-titulo" placeholder="Buscar...">
    <button onclick="buscar()">Buscar</button>
    <div id="resultados-busqueda"></div>

    <!-- Listar disponibles -->
    <h2>Materiales Disponibles</h2>
    <button onclick="listarDisponibles()">Listar Disponibles</button>
    <div id="lista-disponibles"></div>

    <script>
        const API_BASE = 'http://127.0.0.1:5000'; // URL del backend

        // Agregar material
        document.getElementById('form-agregar').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                tipo: document.getElementById('tipo').value,
                titulo: document.getElementById('titulo').value,
                anho: parseInt(document.getElementById('anho').value),
            };
            if (data.tipo === 'libro') {
                data.autor = document.getElementById('autor').value;
                data.isbn = document.getElementById('isbn').value;
                data.num_paginas = parseInt(document.getElementById('num_paginas').value);
            } else {
                data.editorial = document.getElementById('editorial').value;
                data.numero = parseInt(document.getElementById('numero').value);
                data.mes = document.getElementById('mes').value;
            }
            try {
                const response = await fetch(`${API_BASE}/agregar`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                alert(result.mensaje || result.error);
            } catch (error) {
                alert('Error al conectar con el servidor: ' + error.message);
            }
        });

        // Buscar
        async function buscar() {
            const titulo = document.getElementById('buscar-titulo').value;
            try {
                const response = await fetch(`${API_BASE}/buscar?titulo=${encodeURIComponent(titulo)}`);
                const resultados = await response.json();
                document.getElementById('resultados-busqueda').innerHTML = resultados.map(r => `<p>${r.info.replace(/\n/g, '<br>')}</p>`).join('');
            } catch (error) {
                document.getElementById('resultados-busqueda').innerHTML = 'Error: ' + error.message;
            }
        }

        // Listar disponibles
        async function listarDisponibles() {
            try {
                const response = await fetch(`${API_BASE}/listar_disponibles`);
                const disponibles = await response.json();
                document.getElementById('lista-disponibles').innerHTML = disponibles.map(d => `<p>${d.info.replace(/\n/g, '<br>')}</p>`).join('');
            } catch (error) {
                document.getElementById('lista-disponibles').innerHTML = 'Error: ' + error.message;
            }
        }

        // Mostrar/ocultar campos según tipo
        document.getElementById('tipo').addEventListener('change', (e) => {
            document.getElementById('campos-libro').style.display = e.target.value === 'libro' ? 'block' : 'none';
            document.getElementById('campos-revista').style.display = e.target.value === 'revista' ? 'block' : 'none';
        });
    </script>
</body>
</html>