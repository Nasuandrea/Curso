<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cat√°logo de Productos</title>
    <!--Bootstrap-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css" />
</head>

<body>
    <div class="container my-5">
        <!--Bootstrap
        Las clases se nombran usando el formato {property}{sides}-{size} para xs y {property}{sides}-{breakpoint}-{size} para sm, md, lg, xl y xxl.

        Donde property es una de:
        m - para clases que establecen margin
        p - para clases que configuran padding

        Donde sides es uno de:
        t - para clases que establecen margin-top o padding-top
        b - para clases que establecen margin-bottom o padding-bottom
        s - (start) para clases que establecen margin-left o padding-left en LTR, margin-right o padding-right en RTL
        e - (end) para clases que establecen margin-right o padding-right en LTR, margin-left o padding-left en RTL
        x - para clases que configuran tanto *-left como *-right
        y - para clases que configuran tanto *-top como *-bottom
        en blanco - para clases que establecen un margin o padding en los 4 lados del elemento
        -->

        <!-- T√≠tulo principal de la p√°gina -->
        <h1 class="text-center mb-4 text-primary">üõçÔ∏è Cat√°logo de Productos</h1>
        <!-- Tarjeta -->
        <div class="card mb-4">
            <div class="card-body">
                <div class="row align-items-center">
                    <!-- Secci√≥n de filtros -->
                    <div class="col-md-3">
                        <!-- Etiqueta descriptiva para el selector de categor√≠as -->
                        <label for="filtroCategoria" class="form-label fw-bold">Filtrar por categor√≠a:
                        </label>
                    </div>
                    <div class="col-md-4">
                        <!-- Men√∫ desplegable para seleccionar categor√≠a. Al cambiar ejecuta filtrarProductos() -->
                        <select id="filtroCategoria" onchange="filtrarProductos()" class="form-select">
                            <option value="todos">Todos</option>
                            <!-- Opci√≥n para mostrar todos los productos -->
                            <option value="electronica">Electr√≥nica</option>
                            <!-- Filtra solo productos de electr√≥nica -->
                            <option value="ropa">Ropa</option>
                            <!-- Filtra solo productos de ropa -->
                            <option value="hogar">Hogar</option>
                            <!-- Filtra solo productos de hogar -->
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- L√≠nea separadora horizontal -->
        <hr class="my-5" />

        <!-- Contenedor donde se mostrar√°n din√°micamente todos los productos -->
        <div id="productos" class="row"></div>

        <!-- L√≠nea separadora horizontal -->
        <hr class="my-5" />

        <!-- T√≠tulo de la secci√≥n del carrito -->
        <h2 class="text-center mb-4 text-success">üõí Carrito de Compras</h2>
        <div class="card">
            <div class="card-body">
                <!-- Contenedor donde se mostrar√°n los productos agregados al carrito -->
                <div id="carrito"></div>
                <div class="text-end mt-4">
                    <!-- Muestra el total a pagar -->
                    <h3 class="text-primary">
                        Total: <span id="total" class="fw-bold">0.00</span>‚Ç¨
                    </h3>
                    <div class="text-end mt-3">
                        <!-- Bot√≥n para vaciar todo el carrito. Al hacer click ejecuta vaciarCarrito() -->
                        <button onclick="vaciarCarrito()" class="btn btn-danger btn-lg">
                            Vaciar Carrito
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Array con todos los productos disponibles en la tienda
        // Cada producto tiene: id √∫nico, nombre, precio, categor√≠a y stock disponible
        const productos = [
            {
                id: 1,
                nombre: "Laptop HP",
                precio: 599.99,
                categoria: "electronica",
                stock: 5,
                imagen:
                    "https://images.unsplash.com/photo-1693206816304-642a705045a1?w400&h300&fit=crop",
            },
            {
                id: 2,
                nombre: "Mouse Inal√°mbrico",
                precio: 19.99,
                categoria: "electronica",
                stock: 15,
                imagen:
                    "https://images.unsplash.com/photo-1605773527852-c546a8584ea3?w400&h300&fit=crop",
            },
            {
                id: 3,
                nombre: "Teclado Mec√°nico",
                precio: 79.99,
                categoria: "electronica",
                stock: 8,
                imagen:
                    "https://images.unsplash.com/photo-1541140532154-b024d705b90a?w400&h300&fit=crop",
            },
            {
                id: 4,
                nombre: "Camiseta B√°sica",
                precio: 12.99,
                categoria: "ropa",
                stock: 25,
                imagen:
                    "https://images.unsplash.com/photo-1581655353564-df123a1eb820?w400&h300&fit=crop",
            },
            {
                id: 5,
                nombre: "Pantal√≥n Vaquero",
                precio: 39.99,
                categoria: "ropa",
                stock: 12,
                imagen:
                    "https://images.unsplash.com/photo-1542272604-787c3835535d?w400&h300&fit=crop",
            },
            {
                id: 6,
                nombre: "Zapatillas Deportivas",
                precio: 65.0,
                categoria: "ropa",
                stock: 10,
                imagen:
                    "https://images.unsplash.com/photo-1512374382149-233c42b6a83b?w400&h300&fit=crop",
            },
            {
                id: 7,
                nombre: "L√°mpara LED",
                precio: 24.99,
                categoria: "hogar",
                stock: 20,
                imagen:
                    "https://images.unsplash.com/photo-1625810057809-9f596a69b975?w400&h300&fit=crop",
            },
            {
                id: 8,
                nombre: "Coj√≠n Decorativo",
                precio: 15.5,
                categoria: "hogar",
                stock: 30,
                imagen:
                    "https://images.unsplash.com/photo-1531877025030-f7696a50770f?w400&h300&fit=crop",
            },
            {
                id: 9,
                nombre: "Reloj de Pared",
                precio: 32.0,
                categoria: "hogar",
                stock: 7,
                imagen:
                    "https://images.unsplash.com/photo-1527454743534-ba93f2148eb0?w400&h300&fit=crop",
            },
        ];

        // Array que almacena los productos que el usuario ha agregado al carrito
        // Comienza vac√≠o y se llena cuando el usuario agrega productos
        let carrito = [];

        // Funci√≥n que recibe una lista de productos y los muestra en la p√°gina
        function mostrarProductos(listaProductos) {
            // Obtiene el contenedor donde se mostrar√°n los productos
            const contenedor = document.getElementById("productos");

            // Limpia el contenedor para evitar duplicados
            contenedor.innerHTML = "";

            // Recorre cada producto de la lista recibida
            listaProductos.forEach((producto) => {
                // Crea un nuevo elemento div para cada producto
                const div = document.createElement("div");

                // Aplica estilos inline al div (borde, padding, margen)
                /* div.style.border = "1px solid #ccc";
                 div.style.padding = "10px";
                 div.style.margin = "10px 0";*/

                div.className = 'col-md-4 mb-4'

                // Inserta el HTML con la informaci√≥n del producto
                // toFixed(2) redondea el precio a 2 decimales
                // El bot√≥n tiene onclick que ejecuta agregarAlCarrito con el id del producto
                //el card de boostrar con imagen, titulo, texto y bot√≥n
                div.innerHTML = `
                    <div class="card h-100 shadow-sm">
                    <img src= "${producto.imagen}" class="card-img-top" style="height:200px; object-fit:cover;" alt="${producto.nombre}">
                    <div class="card-body">
                    <h5 class="card-tittle text-primary">${producto.nombre}</h5>
                    <h4 class="text-success fw-bold">${producto.precio.toFixed(2)}‚Ç¨ </h4>
                    <p class="card-text"><span class="badge bg-secondary">${producto.categoria}</span></p>
                    <p class="card-text"><small class="text-muted">Stock: ${producto.stock} unidades</small></p>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                    <button class="btn btn-primary w-100" onclick="agregarAlCarrito(${producto.id})">üõí Agregar al Carrito</button>
                    </div>
                    </div>
                `;

                // A√±ade el div creado al contenedor principal
                // appendChild() es un m√©todo de JavaScript que se utiliza en el DOM (Document Object Model) para agregar un nuevo nodo como el √∫ltimo hijo de un elemento padre existente. Si el nodo que se intenta agregar ya tiene un padre, este m√©todo lo eliminar√° de su padre anterior y lo mover√° al nuevo elemento padre.
                contenedor.appendChild(div);
            });
        }

        // Funci√≥n que filtra los productos seg√∫n la categor√≠a seleccionada
        function filtrarProductos() {
            // Obtiene el valor seleccionado en el men√∫ desplegable
            const filtro = document.getElementById("filtroCategoria").value;

            // Si el filtro es "todos", muestra todos los productos
            if (filtro === "todos") {
                mostrarProductos(productos);
            } else {
                // Si no, filtra el array de productos por la categor√≠a seleccionada
                // filter() crea un nuevo array solo con los productos que cumplen la condici√≥n
                const productosFiltrados = productos.filter(
                    (p) => p.categoria === filtro
                );

                // Muestra solo los productos filtrados
                mostrarProductos(productosFiltrados);
            }
        }

        // Funci√≥n que agrega un producto al carrito bas√°ndose en su id
        function agregarAlCarrito(id) {
            // Busca el producto en el array de productos usando su id
            // find() devuelve el primer elemento que cumple la condici√≥n
            const producto = productos.find((p) => p.id === id);

            // Si no encuentra el producto, termina la funci√≥n
            if (!producto) return;

            // Busca si el producto ya existe en el carrito
            const itemCarrito = carrito.find((item) => item.id === id);

            // Si el producto ya est√° en el carrito
            if (itemCarrito) {
                // Verifica que no se exceda el stock disponible
                if (itemCarrito.cantidad < producto.stock) {
                    // Incrementa la cantidad del producto en el carrito
                    itemCarrito.cantidad++;
                } else {
                    // Si no hay m√°s stock, muestra un mensaje de alerta
                    alert("No hay m√°s stock disponible");
                    return; // Termina la funci√≥n sin agregar m√°s
                }
            } else {
                // Si el producto no est√° en el carrito, lo agrega como nuevo item
                // push() a√±ade un elemento al final del array
                carrito.push({
                    id: producto.id,
                    nombre: producto.nombre,
                    precio: producto.precio,
                    cantidad: 1, // Inicia con cantidad 1
                });
            }

            // Actualiza la visualizaci√≥n del carrito
            actualizarCarrito();
        }

        // Funci√≥n que actualiza la vista del carrito de compras
        function actualizarCarrito() {
            // Obtiene el contenedor del carrito
            const contenedor = document.getElementById("carrito");

            // Limpia el contenedor
            contenedor.innerHTML = "";

            // Si el carrito est√° vac√≠o
            if (carrito.length === 0) {
                // Muestra mensaje de carrito vac√≠o
                contenedor.innerHTML = '<div class="alert alert-info text-center">El carrito est√° vac√≠o</div>';

                // Establece el total en 0.00
                document.getElementById("total").textContent = "0.00";
                return; // Termina la funci√≥n
            }

            // Variable para acumular el total de la compra
            let total = 0;

            //Crear una tabla de bootstrap para mostrar los items del carrito
            let tablaHTML = `
            <table class="table table-hover">
                <thead class="table light">
                    <tr>
                        <th>Productos</th>
                        <th class= "text-center">Precio unit.</th>
                        <th class= "text-center">Cantidad</th>
                        <th class= "text-end">Subtotal</th>
                        <th class= "text-center">Acci√≥n</th>
                    </tr>
                </thead>
                <tbody>
                `;
            // Recorre cada item del carrito
            carrito.forEach((item) => {
                // Crea un div para cada producto en el carrito
                //const div = document.createElement("div");

                // Aplica estilos al div
                /*div.style.borderBottom = "1px solid #eee";
                div.style.padding = "5px 0";*/

                // Calcula el subtotal (precio √ó cantidad)
                const subtotal = item.precio * item.cantidad;

                // Suma el subtotal al total acumulado
                total += subtotal;

                // Inserta el HTML con la informaci√≥n del item
                // Incluye bot√≥n para eliminar con onclick que ejecuta eliminarDelCarrito
                /*div.innerHTML = `
                    <strong>${item.nombre}</strong> - 
                    ${item.precio.toFixed(2)}‚Ç¨ x ${item.cantidad} = 
                    ${subtotal.toFixed(2)}‚Ç¨
                    <button onclick="eliminarDelCarrito(${item.id
                    })">Eliminar</button>
                `;*/

                //agregar una fila a la tabla para cada producto
                tablaHTML += `
                <tr>
                    <td class= "fw-bold">${item.nombre}</td>
                    <td class="text-center">${item.precio}‚Ç¨</td>
                    <td class="text-center"><span class="badge bg-primary">${item.cantidad}</span></td>
                    <td class="text-end fw-bold">${item.subtotal}‚Ç¨</td>
                    <td class="text-center"><button onclick="eliminarDelCarrito(${item.id})" class="btn btn-sm btn-danger" >Eliminar</button>"></td>
                </tr>
                `
                // A√±ade el div al contenedor del carrito
                //contenedor.appendChild(div);
            });
            //cerrar la tabla
            tablaHTML += `   
            </tbody>
            </table>
            `;

            // Actualiza el elemento que muestra el total con el valor calculado
            document.getElementById("total").textContent = total.toFixed(2);
        }

        // Funci√≥n que elimina un producto espec√≠fico del carrito
        function eliminarDelCarrito(id) {
            // filter() crea un nuevo array excluyendo el item con el id especificado
            // Mantiene todos los items cuyo id sea diferente al recibido
            carrito = carrito.filter((item) => item.id !== id);

            // Actualiza la vista del carrito
            actualizarCarrito();
        }

        // Funci√≥n que vac√≠a completamente el carrito
        function vaciarCarrito() {
            // Verifica que el carrito tenga productos
            if (carrito.length > 0) {
                // Muestra un cuadro de confirmaci√≥n al usuario
                // confirm() devuelve true si el usuario acepta, false si cancela
                if (confirm("¬øEst√°s seguro de vaciar el carrito?")) {
                    // Vac√≠a el array del carrito asign√°ndole un array vac√≠o
                    carrito = [];

                    // Actualiza la vista del carrito
                    actualizarCarrito();
                }
            }
        }

        // C√≥digo que se ejecuta al cargar la p√°gina
        // Muestra todos los productos inicialmente
        mostrarProductos(productos);
    </script>
</body>

</html>